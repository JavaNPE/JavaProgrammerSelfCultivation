# 01_谷粒商城-项目简介-微服务-集群-负载均衡-注册中心-服务熔断-降级-网关讲解

源码地址：[GitHub - 谷粒商城](https://github.com/JavaNPE/gulimall.git)

# 一、项目简介

## 1、项目背景

### 1）、电商模式

市面上有5种常见的电商模式：B2B、B2C、C2B、C2C、 O2O；

> 1、B2B模式
> 

B2B (Business to Business)，是指商家 与商家建立的商业关系。如: 阿里巴巴。

> 2、B2C模式
> 

B2C (Business to Consumer)，就 是我们经常看到的供应商直接把商品卖给用户，即“商对客”
模式，也就是通常说的商业零售，直接面向消费者销售产品和服务。如:苏宁易购、京东、
天猫、小米商城。

> 3、C2B 模式
> 

C2B (Customer to Business)，即消费者对企业。先有消费者需求产生而后有企业生产，即先
有消费者提出需求，后有生产企业按需求组织生产。

> 4、C2C模式
> 

C2C (Customer to Consumer)，客户之间自己把东西放上网去卖，如:淘宝，闲鱼。

> 5、O2O模式
> 

020即Online To Offline，也即将线下商务的机会与互联网结合在了一起，让互联网成为线
下交易的前台。线上快速支付，线下优质服务。如:饿了么，美团，淘票票，京东到家。

### 2)、谷粒商城

谷粒商城是一个B2C模式的电商平台，销售自营商品给客户。

## 2、项目架构图

### 2.1项目微服务架构图

![](https://hediancha-1312143060.cos.ap-shanghai.myqcloud.com/202206062057178.png)

![](https://hediancha-1312143060.cos.ap-shanghai.myqcloud.com/202206062059373.png)

### 2.2微服务划分图

![](https://hediancha-1312143060.cos.ap-shanghai.myqcloud.com/202206062059374.png)

## 3、项目技术&特色

- 前后分离开发，并开发基于vue的后台管理系统
- SpringCloud全新的解决方案
- 应用监控、限流、网关、熔断降级等分布式方案全方位涉及
- 透彻讲解分布式事务、分布式锁等分布式系统的难点
- 分析高并发场景的编码方式，线程池，异步编排等使用
- 压力测试与性能优化
- 各种集群技术的区别以及使用
- CI/CD使用
- 。。。。。。。。。。

## 4、项目前置要求

学习项目的前置知识

- 熟悉SpringBoot以及常见整合方案
- 了解SpringCloud
- 熟悉git，maven
- 熟悉linux，redis， docker 基本操作
- 了解html, css， js， vue
- 熟练使用idea开发项目

# 二、分布式基础概念

## 1、微服务

微服务架构风格，就像是把一个单独的应用程序开发为一套小服务，每个小服务运行在自己的进程中，并使用轻量级机制通信，通常是HTTP API。这些服务围绕业务能力来构建，并通过完全自动化部署机制来独立部署。这些服务使用不同的编程语言书写，以及不同数据存储技术，并保持最低限度的集中式管理。

**简而言之:拒绝大型单体应用，基于业务边界进行服务微化拆分，各个服务独立部署运行。**

![链路追踪：参考zipkin](https://hediancha-1312143060.cos.ap-shanghai.myqcloud.com/202206062059376.png)

链路追踪：参考zipkin

## 2、集群&分布式&节点

集群是个物理形态，分布式是个工作方式。

乐只要是一堆机器，就可以叫集群，他们是不是一起协作着干活，这个谁也不知道；

**《分布式系统原理与范型》定义：**

“分布式系统是若干独立计算机的集合，这些计算机对于用户来说就像单个相关系统”

分布式系统(distributed system)是建立在网络之上的软件系统。

### 2.1 分布式是什么：

**分布式是指将不同的业务分布在不同的地方。**

### 2.2 集群是什么：

**集群指的是将几台服务器集中在一起，实现同一业务。**

例如：**京东是一个分布式系统，众多业务运行在不同的机器**，**所有业务构成一个大型的业务集群**。每一个小的业务，比如用户系统，访问压力大的时候一台服务器是不够的。我们就应该将用户系统部署到多个服务器，也就是**每一个业务系统也可以做集群化；**

**分布式中的每一个 节点，都可以做集群。而集群并不一定就是分布式的。**

**【解释】比如用户服务器虽然是集群但是处理的都是同一业务，所以说集群并不一定就是分布式的，而整个京东才是分布式的，因为这个系统的各个业务运行在不同的地方，各各工作各自的，合起来整个一个完整的系统。**

### 2.3 什么是节点：

**节点：集群中的每一个服务器。**

## 3、远程调用：SpringCloud中使用**HTTP+JSON的方式完成远程调用**

在分布式系统中，各个服务可能处于不同主机，但是服务之间不可避免的需要互相调用，我
们称为远程调用。

**SpringCloud中使用HTTP+JSON的方式完成远程调用。**

![](https://hediancha-1312143060.cos.ap-shanghai.myqcloud.com/202206062059377.png)

## 4、负载均衡

![](https://hediancha-1312143060.cos.ap-shanghai.myqcloud.com/202206062059378.png)

分布式系统中，A服务需要调用B服务，B服务在多台机器中都存在，A调用任意一个服务器均可完成功能。

为了使每一个服务器都不要太忙或者太闲，我们可以负载均衡的调用每一个服务器,提升网站的健壮性。

### 4.1 常见的负载均衡算法：轮询，最小连接，**散列**

**轮询：**为第一个请求选择健康池中的第一个后端服务器，然后按顺序往后依次选择，直到最后一个，然后循环。
**最小连接：**优先选择连接数最少，也就是压力最小的后端服务器,在会话较长的情况下可以考虑采取这种方式。

**散列：**根据请求源的IP 的散列(hash) 来选择要转发的服务器。这种方式可以一定程度上保证特定用户能连接到相同的服务器。如果你的应用需要处理状态而要求用户能连接到和之前相同的服务器，可以考虑采取这种方式。

## 5、服务注册/发现&注册中心

A服务调用B服务, A服务并不知道B服务当前在哪几台服务器有，哪些正常的，哪些服务已经下线。解决这个问题可以引入注册中心;

![](https://hediancha-1312143060.cos.ap-shanghai.myqcloud.com/202206062059379.png)

![](https://hediancha-1312143060.cos.ap-shanghai.myqcloud.com/202206062059380.png)

如果某些服务下线,我们其他人可以实时的感知到其他服务的状态，从而避免调用不可用的服务。

## 6、配置中心

![](https://hediancha-1312143060.cos.ap-shanghai.myqcloud.com/202206062059381.png)

每一个服务最终都有大量的配置,并且每个服务都可能部署在多台机器上。我们经常需要变更配置，我们可以让每个服务在配置中心获取自己的配置。

**配置中心用来集中管理微服务的配置信息**

## 7、服务熔断&服务降级

在微服务架构中，微服务之间通过网络进行通信，存在相互依赖，当其中一个服务不可用时，有可能会造成雪崩效应。要防止这样的情况，必须要有容错机制来保护服务。

![](https://hediancha-1312143060.cos.ap-shanghai.myqcloud.com/202206062059382.png)

### 7.1 服务熔断

a. 设置服务的超时，当被调用的服务经常失败到达某个阈值，我们可以开启断路保护机制，后来的请求不再去调用这个服务。本地直接返回默认的数据

### 7.2 服务降级

a.在运维期间，当系统处于高峰期，系统资源紧张，我们可以让非核心业务降级运行。

降级：某些服务不处理,或者简单处理【抛异常、返回NULL、调用Mock数据、调用Fallback处理逻辑】。

## 8、API网关：API Gateway

在微服务架构中，API Gateway作为整体架构的**重要组件**，它抽象了微服务中都需要的公共功能，同时提供了客户端负载均衡，服务自动熔断，灰度发布，统一认证，限流流控，日志统计等丰富的功能，帮助我们解诀很多API管理难题。

![](https://hediancha-1312143060.cos.ap-shanghai.myqcloud.com/202206062059383.png)